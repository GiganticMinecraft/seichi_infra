apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: argocd
  namespace: argocd
spec:
  project: default
  source:
    chart: proxy-k8s-argo-cd
    repoURL: https://giganticminecraft.github.io/seichi_infra
    targetRevision: 1.0.6
    helm:
      releaseName: proxy-k8s-argo-cd
      values: |
        # argo-cd is a dependency chart so we must override values like this
        # https://helm.sh/docs/chart_template_guide/subcharts_and_globals/
        argocd:
          server:
            configEnabled: true
            # -- [General Argo CD configuration]
            # @default -- See [values.yaml]
            config:
              # Argo CD instance label key
              application.instanceLabelKey: argocd.argoproj.io/instance
              kustomize.buildOptions: --load-restrictor LoadRestrictionsNone
              kustomize.buildOptions.v4.4.0: --output /tmp
              ## Following settings are required when configuring SSO
              # Argo CD's externally facing base URL (optional).
              url: https://argocd.bungee-proxy-public.seichi.click
              dex.config: |
                connectors:
                  - type: github
                    id: github
                    name: GitHub
                    config:
                      clientID: 6d77699f96a51159ce39
                      clientSecret: $argocd-github-client-secret:dex.github.clientSecret
                      orgs:
                      - name: GiganticMinecraft

            rbacConfig:
              # policy.csv is an file containing user-defined RBAC policies and role definitions (optional).
              # Policy rules are in the form:
              #   p, subject, resource, action, object, effect
              # Role definitions and bindings are in the form:
              #   g, subject, inherited-subject
              # See https://github.com/argoproj/argo-cd/blob/master/docs/operator-manual/rbac.md for additional information.
              policy.csv: |
                g, GiganticMinecraft:admin-team, role:admin
                g, GiganticMinecraft:infra-collaborator, role:admin
              # policy.default is the name of the default role which Argo CD will falls back to, when
              # authorizing API requests (optional). If omitted or empty, users may be still be able to login,
              # but will see no apps, projects, etc...
              policy.default: role:readonly
  destination:
    server: https://kubernetes.default.svc
    namespace: argocd
  syncPolicy:
    automated:
      prune: true
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: argocd-github-client-secret
  namespace: argocd
spec:
  encryptedData:
    dex.github.clientSecret: AgAhwGEL/UUKTZAJ7uTSOEcgU8W0m5XAmJgITx5AGdthhwEr5zyIVJQbw2t59gkcIti+rcI6n41SeTK7RoJCYrDBEbgfV8cv54T8Rla5cCdvJuJ3xd3gwgk1lgeU4m7q//Bz/+JCqzpPCD5HHwCJyjQGG8iLCu2pSo5yS2mmxS+/kewJZoiM0lz9lYGO7iY/OGWFPsZes4RGaB7Ijy+DdRTlnBhT7ilIcBFknJM2J8AsplocCx42u8hTNZVCzg5S8m6OIDunn+VhPuADrXAfnEkF2MLUXcNzhY2sR5hLsof1CXHLOOpGmTAZ4CE4JuVE9oAPnMKlr8HG2sWnAoCL1d6fLpHTzzo3fUhypcsVkp6FZk6/73yw5C35dhoZIq1Xt/0vRrf3RbChtRJui7BXKfkPHkrlq23R0E/bPvwUnAOurQhjmJlp5HAGuVpAuQlqkq+PAoAqtgq7fwQi+rifIoS7Gyn5IFO+Ep4SDK7LMnP7Apl5pvc8yU8es02qBDvztXzyAEu4Y/Vyt0qH4Dk25TCxcMMUD2V+N8Rx/RvorX2wKKh8YnFfxiYoix4wTvSjF1HpmsMDgmBUK2otqIGyO0mEH4RZ1uMBe37wn/IA2bQNzCFyFvt2NHkn8p8ZKTWEKunoTpvdmW1bViiU3f7EWYFpsAQUzgMHvIfFahOrtrHneDRX/e3QirkyrXl1SZkaFa7wHkHqj69IQDegi7ShpbljbP2onWf90DQ0dvbgJyLY8znVxLWVQMz6
  template:
    type: Opaque
    metadata:
      labels:
        "app.kubernetes.io/part-of": argocd
