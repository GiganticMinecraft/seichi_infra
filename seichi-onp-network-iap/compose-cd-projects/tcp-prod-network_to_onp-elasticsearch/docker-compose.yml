volumes:
  cloudflared-home:

services:
  cloudflared:
    image: ghcr.io/giganticminecraft/cloudflared-with-auto-dns-route:2f9a183
    volumes:
      - cloudflared-home:/root
      - ./cloudflared-tunnel-config.yml:/etc/cloudflared/tunnel-config.yml
    network_mode: "host"
    restart: always
    # elasticsearch-server
    # k8s上のfilebeatなどからのログ連携を想定
    # cloudflare-service-tokenによるアクセス制御を行う
    environment:
      TUNNEL_NAME: seichi-onp-network-iap-onp-elasticsearch-tunnel
      CLOUDFLARED_HOSTNAME: elasticsearch.tcp-prod-network.seichi.click
      CLOUDFLARED_SERVICE: "tcp://192.168.3.20:9200"
