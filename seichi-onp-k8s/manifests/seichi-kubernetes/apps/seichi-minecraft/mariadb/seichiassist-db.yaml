apiVersion: k8s.mariadb.com/v1alpha1
kind: User
metadata:
  namespace: seichi-minecraft
  name: mcserver
spec:
  mariaDbRef:
    name: mariadb
    waitForIt: true
  passwordSecretKeyRef:
    name: mariadb
    key: mcserver-password
  # NOTE: mcserver ユーザーは、ゲーム内プラグイン SeichiAssist に加え、seichi-game-data-server(ゲームデータ公開用サーバー)が使用する。
  #   SeichiAssist は初期化時に Connection を5つ、最大時に20個張る。
  #   seichi-game-data-server は初期化時に Connection を最大5つ貼る。
  #   また、SeichiAssist が稼働しているサーバーは6サーバーあり、各サーバーで最大20個のコネクションを張ることがある。
  #   したがって、最大で 20*6 + 5 = 125 個のコネクションを張る可能性がある。
  maxUserConnections: 150

---
apiVersion: k8s.mariadb.com/v1alpha1
kind: Database
metadata:
  namespace: seichi-minecraft
  name: seichiassist
spec:
  mariaDbRef:
    name: mariadb
    waitForIt: true
  characterSet: utf8mb4
  collate: utf8mb4_general_ci
  name: seichiassist

---
apiVersion: k8s.mariadb.com/v1alpha1
kind: Grant
metadata:
  namespace: seichi-minecraft
  name: seichiassist
spec:
  mariaDbRef:
    name: mariadb
    waitForIt: true
  privileges:
    - "ALL"
  database: "seichiassist"
  table: "*"
  username: "mcserver"
  grantOption: false
